<!DOCTYPE html>
<html>
<head>
  <title>Home - U.S. Fiscal Tracker</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest" defer></script>
</head>
<body>

  <!-- Navigation Bar -->
  <nav class="navbar">
    <a href="index.html">Home</a>
    <a href="about.html">About</a>
    <a href="trends.html">Trends</a>
  </nav>

  <h1>Welcome to U.S. Fiscal Tracker</h1>
  <p>This tool helps users explore official government revenue and spending using data from the Treasuryâ€™s Monthly Treasury Statement (MTS).</p>

  <h2>Summary Statistics</h2>
  <p>Total Revenue: <span id="rev">$0.00</span></p>
  <p>Total Spending: <span id="spend">$0.00</span></p>
  <p>Total Deficit: <span id="def">$0.00</span></p>

  <button onclick="loadYTDData()">Load 2024 Treasury Data</button>

  <h2>All Fiscal Data</h2>
  <p style="font-size: 1em; color: gray;">
  Each row represents a line item from the U.S. Treasury's Monthly Treasury Statement (MTS) for FY2024. The rows are are the most recent cumulative totals of shows either total revenue collected or total spending to date.
</p>

  <table id="fiscalTable">
    <thead>
      <tr>
        <th>Fiscal Year</th>
        <th>Amount (YTD)</th>
        <th>Type</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
  

  <script>
    // POST Treasury API 
    function loadYTDData() {
      fetch('/api/fetchAndStoreYTD', { method: 'POST' })
        .then(res => res.json())
        .then(data => {
          alert(data.success ? `Stored records or accessing already stored data.` : 'Error storing data.');
          location.reload(); // refresh to show updated stats
        });
    }

    // Fetch and display Supabase data
    async function loadSummaryAndTable() {
      const res = await fetch('/api/getStoredData');
      const data = await res.json();

      let totalRevenue = 0;
      let totalSpending = 0;
      const tableBody = document.getElementById('tableBody');

      data.forEach(row => {
        if (row.type === "Revenue") totalRevenue += row.amount;
        else if (row.type === "Spending") totalSpending += row.amount;

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${row.fiscal_year}</td>
          <td>$${row.amount.toFixed(2)}</td>
          <td>${row.type}</td>
        `;
        tableBody.appendChild(tr);
      });

      document.getElementById('rev').textContent = `$${totalRevenue.toFixed(2)}`;
      document.getElementById('spend').textContent = `$${totalSpending.toFixed(2)}`;
      document.getElementById('def').textContent = `$${(totalSpending - totalRevenue).toFixed(2)}`;

      new simpleDatatables.DataTable("#fiscalTable");
    }

    window.onload = loadSummaryAndTable;
  </script>

</body>
</html>
